<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebRTC 화면 공유 및 시그널링 예제</title>
</head>
<body>
    <h2>WebRTC 화면 공유 및 시그널링 예제</h2>
    <button id="startButton">화면 공유 시작</button>
    <div id="localVideoContainer"></div>
    <div id="remoteVideoContainer"></div>

    <script>
        const startButton = document.getElementById('startButton');
        const localVideoContainer = document.getElementById('localVideoContainer');
        const remoteVideoContainer = document.getElementById('remoteVideoContainer');

        let localStream;
        let remoteStream;
        let isScreenSharing = false;

        startButton.addEventListener('click', async () => {
            try {
                if (!isScreenSharing) {
                    // 화면 공유 시작
                    localStream = await navigator.mediaDevices.getDisplayMedia({ video: true });

                    // 로컬 비디오 표시
                    const localVideo = document.createElement('video');
                    localVideo.srcObject = localStream;
                    localVideo.autoplay = true;
                    localVideoContainer.appendChild(localVideo);

                    // 피어 연결 설정
                    const configuration = { iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] };
                    const peerConnection = new RTCPeerConnection(configuration);

                    // 로컬 스트림을 PeerConnection에 추가
                    localStream.getTracks().forEach(track => peerConnection.addTrack(track, localStream));

                    // Offer 생성
                    const offer = await peerConnection.createOffer();
                    await peerConnection.setLocalDescription(offer);

                    // Offer를 복사하여 시그널링을 통해 상대방에게 전달 (대화 상자로 직접 입력)
                    const offerData = prompt('Offer를 상대방에게 전달하세요:', JSON.stringify(peerConnection.localDescription));

                    // Answer를 생성하기 위해 대화 상자로부터 상대방의 입력을 받음
                    const answerData = prompt('상대방의 Answer를 입력하세요:');

                    // 상대방의 Answer 설정
                    await peerConnection.setRemoteDescription(new RTCSessionDescription(JSON.parse(answerData)));

                    // 화면 공유를 위한 ICE Candidate 교환 (이 부분도 시그널링 서버를 통해 이루어짐)
                    peerConnection.onicecandidate = (event) => {
                        if (event.candidate) {
                            console.log('ICE Candidate를 상대방에게 전달:', event.candidate);
                            // 이 부분에서 상대방에게 event.candidate를 전달하는 코드가 필요
                        }
                    };

                    // 원격 비디오 표시
                    peerConnection.ontrack = (event) => {
                        remoteStream = event.streams[0];
                        const remoteVideo = document.createElement('video');
                        remoteVideo.srcObject = remoteStream;
                        remoteVideo.autoplay = true;
                        remoteVideoContainer.appendChild(remoteVideo);
                    };

                    isScreenSharing = true;
                } else {
                    // 화면 공유 중지
                    localStream.getTracks().forEach(track => track.stop());
                    localVideoContainer.innerHTML = '';
                    remoteVideoContainer.innerHTML = '';
                    isScreenSharing = false;
                }
            } catch (error) {
                console.error('화면 공유 오류:', error);
            }
        });
    </script>
</body>
</html>
