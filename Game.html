<!DOCTYPE html>
<html>
<head>
  <title>퇴근하고 싶다</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
    }
    #square {
      width: 50px;
      height: 50px;
      background-color: red;
      position: absolute;
    }
    .obstacle {
      width: 50px;
      height: 50px;
      background-color: blue;
      position: absolute;
    }
    .obstacle.large {
      width: 200px;
      height: 200px;
      background-color: purple;
    }
    .bullet {
      width: 10px;
      height: 10px;
      background-color: green;
      position: absolute;
    }
    #score {
      position: absolute;
      top: 10px;
      left: 10px;
      font-size: 18px;
      color: black;
    }
  </style>
</head>
<body>
  <div id="square"></div>
  <div id="score">파괴 : 0</div>

  <script>
    const square = document.getElementById('square');
    let posX = 0;
    let posY = 0;
    let playerSpeedX = 0;
    let playerSpeedY = 0;
    const acceleration = 0.5;
    const friction = 0.9;
    const step = 20;
    let isGameOver = false;
    let score = 0;
    let bulletPosX;
    let bulletPosY;
    let isBulletFired = false;
    const bulletSpeed = 10;
    const largeObstacleHitsRequired = 8;

    function moveSquare() {
      if (isGameOver) return;

      posX += playerSpeedX;
      posY += playerSpeedY;

      if (posX < 0 || posX + 50 > window.innerWidth || posY < 0 || posY + 50 > window.innerHeight) {
        isGameOver = true;
        alert('게임 종료! 장애물에 부딪혔습니다. 파괴한 장애물 개수: ' + score);
        return;
      }

      square.style.top = posY + 'px';
      square.style.left = posX + 'px';

      checkCollision();
    }

    function createObstacle() {
      if (isGameOver) return;

      const obstacle = document.createElement('div');
      const isLargeObstacle = Math.random() < 0.1;
      obstacle.className = isLargeObstacle ? 'obstacle large' : 'obstacle';
      
      obstacle.style.top = Math.floor(Math.random() * window.innerHeight) + 'px';
      obstacle.style.left = window.innerWidth + 'px';
      obstacle.moveX = -Math.floor(Math.random() * 5) - 2;

      document.body.appendChild(obstacle);

      setTimeout(createObstacle, 600);
    }

    function checkCollision() {
      const obstacles = document.getElementsByClassName('obstacle');
      for (let i = 0; i < obstacles.length; i++) {
        const obstacle = obstacles[i];
        const obstacleRect = obstacle.getBoundingClientRect();
        const squareRect = square.getBoundingClientRect();

        if (
          squareRect.left < obstacleRect.right &&
          squareRect.right > obstacleRect.left &&
          squareRect.top < obstacleRect.bottom &&
          squareRect.bottom > obstacleRect.top
        ) {
          isGameOver = true;
          alert('게임 종료! 장애물에 부딪혔습니다. 파괴한 장애물 개수: ' + score);
          break;
        }
      }
    }

    document.addEventListener('keydown', (event) => {
      const key = event.key;
      if (key === 'ArrowUp' || key === 'ArrowDown' || key === 'ArrowLeft' || key === 'ArrowRight') {
        applyAcceleration(key);
      }
      if (key === 'Control' && !isBulletFired) {
        fireBullet();
      }
    });

    document.addEventListener('keyup', () => {
      playerSpeedX *= friction;
      playerSpeedY *= friction;
    });

    function applyAcceleration(direction) {
      switch (direction) {
        case 'ArrowUp':
          playerSpeedY -= acceleration;
          break;
        case 'ArrowDown':
          playerSpeedY += acceleration;
          break;
        case 'ArrowLeft':
          playerSpeedX -= acceleration;
          break;
        case 'ArrowRight':
          playerSpeedX += acceleration;
          break;
      }
    }

    function fireBullet() {
      if (isGameOver) return;

      isBulletFired = true;
      bulletPosX = posX + 50;
      bulletPosY = posY + 25;
      const bullet = document.createElement('div');
      bullet.className = 'bullet';
      bullet.style.top = bulletPosY + 'px';
      bullet.style.left = bulletPosX + 'px';
      bullet.moveX = bulletSpeed;

      document.body.appendChild(bullet);

      setTimeout(() => {
        bullet.remove();
        isBulletFired = false;
      }, 1000);
    }

    function moveObstacles() {
      if (isGameOver) return;

      const obstacles = document.getElementsByClassName('obstacle');
      for (let i = 0; i < obstacles.length; i++) {
        const obstacle = obstacles[i];
        let obstacleRect = obstacle.getBoundingClientRect();

        const newX = obstacleRect.left + obstacle.moveX;

        if (newX < -50) {
          if (obstacleRect.left >= 0) {
            score += 1;
            document.getElementById('score').textContent = '파괴 : ' + score;
          }
          obstacle.remove();
        } else {
          obstacle.style.left = newX + 'px';
        }
      }

      requestAnimationFrame(moveObstacles);
    }

    function moveBullets() {
      if (isGameOver) return;

      const bullets = document.getElementsByClassName('bullet');
      for (let i = 0; i < bullets.length; i++) {
        const bullet = bullets[i];
        let bulletRect = bullet.getBoundingClientRect();

        const newX = bulletRect.left + bullet.moveX;

        if (newX > window.innerWidth) {
          bullet.remove();
          isBulletFired = false;
        } else {
          bullet.style.left = newX + 'px';
          checkBulletCollision(bullet);
        }
      }

      requestAnimationFrame(moveBullets);
    }

    function checkBulletCollision(bullet) {
      const obstacles = document.getElementsByClassName('obstacle');
      for (let i = 0; i < obstacles.length; i++) {
        const obstacle = obstacles[i];
        const obstacleRect = obstacle.getBoundingClientRect();
        const bulletRect = bullet.getBoundingClientRect();

        if (
          bulletRect.left < obstacleRect.right &&
          bulletRect.right > obstacleRect.left &&
          bulletRect.top < obstacleRect.bottom &&
          bulletRect.bottom > obstacleRect.top
        ) {
          if (obstacle.classList.contains('large')) {
            obstacle.hits = obstacle.hits || 0;
            obstacle.hits += 1;

            if (obstacle.hits >= largeObstacleHitsRequired) {
              obstacle.remove();
              score += 8;
              document.getElementById('score').textContent = '파괴 : ' + score;
            }
          } else {
            obstacle.remove();
            score += 1;
            document.getElementById('score').textContent = '파괴 : ' + score;
          }

          bullet.remove();
          isBulletFired = false;
          break;
        }
      }
    }

    createObstacle();
    moveObstacles();
    moveBullets();
    setInterval(moveSquare, 1000 / 60); // 60fps로 설정
  </script>
</body>
</html>
